<html lang="en"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6ImUzOGIyZmQ4N2FiNjRlNWIzOGQzZjliYzA1MWQwMWRkOWE0NGEyMDAiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6XC9cL2lkZW50aXR5dG9vbGtpdC5nb29nbGVhcGlzLmNvbVwvZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIwOTE1MjIyOTY1MzQ0NDU0MzI4NiIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiJjX2YzOGRkYTRjY2E3MmFjZmJfY29taWNfYXBwXzIwMjQtNjgwIn0sImV4cCI6MTc1NDk3MzIzNiwiaWF0IjoxNzU0OTY5NjM2LCJhbGciOiJSUzI1NiJ9.zZ2Ev_fpPBFcuYZCBILLsS3bwodlNGgVmfvRu-sJnIFCSkV34ySfYmHseb8HbgKj_pe_qEoH4X09W6AxJQ_hIGRCcZBTsJwIJs-c6X0ydNYIP0bC0Jit6gUZFkBLizXfYHY8QTYqhLYaNeTdh92vQXLVpGsjR3hIJRVmVXxLX0w1ytuLwd3wKe9PDKNDesuB7L1Pw_qymFM3t6KLlQcofS1QiOXe4s1YT666GMgeEMT0BJi3cYMVPXAwgqeBF9eYHtmEJk2bf97-8fBaGkou-T1Zm3EJ_qF5xHBiqeEQX90DQh4YbIjnT5e6DF4Z7tyhu2czRZ_QxJVHextSWDrOhA","c_f38dda4cca72acfb_comic_app_2024-680")</script><script>'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function q(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var f=a[c];if(!(f in d))break a;d=d[f]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,f){function e(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(e,f)}e(a.next())})}function t(a){return r(a())}
q("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});q("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var f=c.length;d=d||0;for(d<0&&(d=Math.max(d+f,0));d<f;d++){var e=c[d];if(e===b||Object.is(e,b))return!0}return!1}});/*

 MIT License

 Copyright (c) 2017-2023 W.Y.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(f=>{d[f]=c[f]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}function x(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function y(a,b={}){var d;if(!(d=b.width)){d=x(a,"border-left-width");var c=x(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=x(a,"border-top-width"),c=x(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function z(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function A(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function B(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),f=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);f.setAttribute("width","100%");f.setAttribute("height","100%");f.setAttribute("x","0");f.setAttribute("y","0");f.setAttribute("externalResourcesRequired","true");c.appendChild(f);f.appendChild(a);return A(c)})}
var C=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||C(a,b)};function D(a){return w(a).map(b=>{const d=a.getPropertyValue(b),c=a.getPropertyPriority(b);return`${b}: ${d}${c?" !important":""};`}).join(" ")}
function E(a,b,d){a=window.getComputedStyle(a,d);var c=a.getPropertyValue("content");if(c!==""&&c!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(g){return}c=document.createElement("style");var e=c.appendChild;d=`.${f}:${d}`;a.cssText?(f=a.getPropertyValue("content"),a=`${a.cssText} content: '${f.replace(/'|"/g,"")}';`):a=D(a);e.call(c,document.createTextNode(`${d}{${a}}`));b.appendChild(c)}};function F(a){return a.search(/^(data:)/)!==-1}function G(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const f=yield c.blob();return new Promise((e,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{e(d({l:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(f)})})}const H={};function I(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function J(a,b,d){return t(function*(){const c=I(a,b,d.A);if(H[c]!=null)return H[c];d.m&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let f;try{const e=yield G(a,d.i,({l:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});f=`data:${b};base64,${e}`}catch(e){f=d.v||""}return H[c]=f})};const K={N:"application/font-woff",O:"application/font-woff",L:"application/font-truetype",o:"application/vnd.ms-fontobject",F:"image/png",C:"image/jpeg",B:"image/jpeg",u:"image/gif",K:"image/tiff",J:"image/svg+xml",M:"image/webp"};function L(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function M(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):z(b)})}function N(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return z(d)}d=a.poster;d=yield J(d,K[L(d).toLowerCase()]||"",b);return z(d)})}
function O(a){return t(function*(){try{let b;if(a==null?0:(b=a.contentDocument)==null?0:b.body)return yield P(a.contentDocument.body,{},!0)}catch(b){}return a.cloneNode(!1)})}function aa(a,b){return t(function*(){return C(a,HTMLCanvasElement)?M(a):C(a,HTMLVideoElement)?N(a,b):C(a,HTMLIFrameElement)?O(a):a.cloneNode(!1)})}
function ba(a,b,d){return t(function*(){let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let f;if(C(a,HTMLIFrameElement)&&((f=a.contentDocument)==null?0:f.body))c=w(a.contentDocument.body.childNodes);else{let e;c=w(((e=a.shadowRoot)!=null?e:a).childNodes)}}if(c.length===0||C(a,HTMLVideoElement))return b;yield c.reduce((f,e)=>f.then(()=>P(e,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());return b})}
function ca(a,b){const d=b.style;if(d){var c=window.getComputedStyle(a);c.cssText?(d.style.cssText=c.cssText,d.transformOrigin=c.transformOrigin):w(c).forEach(f=>{let e=c.getPropertyValue(f);f==="font-size"&&e.endsWith("px")&&(e=`${Math.floor(parseFloat(e.substring(0,e.length-2)))-.1}px`);C(a,HTMLIFrameElement)&&f==="display"&&e==="inline"&&(e="block");f==="d"&&b.getAttribute("d")&&(e=`path(${b.getAttribute("d")})`);d.setProperty(f,e,c.getPropertyPriority(f))})}}
function da(a,b){C(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ea(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var f=0;f<d.length;f++){var e=d[f].getAttribute("xlink:href");if(e){const g=document.querySelector(e);a.querySelector(e)||!g||c[e]||(c[e]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";f=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(f);for(e=0;e<d.length;e++)f.appendChild(d[e]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>aa(c,b)).then(c=>ba(a,c,b)).then(c=>{C(c,Element)&&(ca(a,c),E(a,c,":before"),E(a,c,":after"),C(a,HTMLTextAreaElement)&&(c.textContent=a.value),C(a,HTMLInputElement)&&c.setAttribute("value",a.value),da(a,c));return c}).then(c=>ea(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,fa=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ha=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ia(a){const b=[];a.replace(Q,(d,c,f)=>{b.push(f);return d});return b.filter(d=>!F(d))}
function ja(a,b,d,c){return t(function*(){try{const f=d?(new URL(b,d||void 0)).toString():b;let e;e=yield J(f,K[L(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${e}$3`)}catch(f){}return a})}function ka(a,{G:b}){return b?a.replace(ha,d=>{for(;;){const [c,,f]=fa.exec(d)||[],e=c,g=f;if(!g)return"";if(g===b)return`src: ${e};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ka(a,d);return ia(c).reduce((f,e)=>f.then(g=>ja(g,e,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const f=(c=b.style)==null?void 0:c.getPropertyValue(a);return f?(c=yield R(f,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function la(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("mask-image",a,b))})}
function ma(a,b){return t(function*(){const d=C(a,HTMLImageElement);if(d&&!F(a.src)||C(a,SVGImageElement)&&!F(a.href.baseVal)){var c=d?a.src:a.href.baseVal,f=yield J(c,K[L(c).toLowerCase()]||"",b);yield new Promise((e,g)=>{a.onload=e;a.onerror=g;a.decode&&(a.onload=()=>{a.decode().then(()=>{requestAnimationFrame(e)})},a.decoding="sync");a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=f):a.href.baseVal=f})}})}
function na(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){C(a,Element)&&(yield la(a,b),yield ma(a,b),yield na(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,f=(d.match(/url\([^)]+\)/g)||[]).map(e=>t(function*(){let g=e.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return G(g,b.i,({result:k})=>{d=d.replace(e,`url(${k})`);return[e,k]})}));return Promise.all(f).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let f=d.exec(a);if(f===null)if(f=c.exec(a),f===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(f[0])}return b}
function oa(a,b){return t(function*(){const d=[],c=[];a.forEach(f=>{if("cssRules"in f)try{w(f.cssRules||[]).forEach((e,g)=>{if(e.type===CSSRule.IMPORT_RULE){let k=g+1;e=V(e.href).then(m=>W(m,b)).then(m=>X(m).forEach(p=>{try{f.insertRule(p,p.startsWith("@import")?k+=1:f.cssRules.length)}catch(za){}})).catch(()=>{});c.push(e)}})}catch(e){const g=a.find(k=>k.href==null)||document.styleSheets[0];f.href!=null&&c.push(V(f.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,f.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(f=>{if("cssRules"in f)try{w(f.cssRules||[]).forEach(e=>{d.push(e)})}catch(e){}});return d})})}function pa(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function qa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield oa(d,b);return pa(d)})}
function ra(a,b){return t(function*(){const d=yield qa(a,b);return(yield Promise.all(d.map(c=>R(c.cssText,c.parentStyleSheet?c.parentStyleSheet.href:null,b)))).join("\n")})}function sa(a,b){return t(function*(){const d=b.j!=null?b.j:b.I?null:yield ra(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function ta(a,b={}){return t(function*(){const {width:d,height:c}=y(a,b),f=yield P(a,b,!0);yield sa(f,b);yield T(f,b);u(f,b);return yield B(f,d,c)})}
function ua(a,b={}){return t(function*(){const {width:d,height:c}=y(a,b);var f=yield ta(a,b);f=yield z(f);const e=document.createElement("canvas"),g=e.getContext("2d"),k=b.D||window.devicePixelRatio||1,m=b.h||d,p=b.g||c;e.width=m*k;e.height=p*k;!b.H&&(e.width>16384||e.height>16384)&&(e.width>16384&&e.height>16384?e.width>e.height?(e.height*=16384/e.width,e.width=16384):(e.width*=16384/e.height,e.height=16384):e.width>16384?(e.height*=16384/e.width,e.width=16384):(e.width*=16384/e.height,e.height=
16384));e.style.width=`${m}`;e.style.height=`${p}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,e.width,e.height));g.drawImage(f,0,0,e.width,e.height);return e})}function Y(a,b={}){return t(function*(){return(yield ua(a,b)).toDataURL()})};const va=["gemini.google.com","corp.google.com"];function Z(){return document.body.querySelectorAll('[class*="animate"]').length>0}function wa(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(f=>f.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function xa(a){return t(function*(){let b=document.body;if(Z()){var d=yield wa();b=d;document.body.appendChild(d)}d=yield Y(b,{h:b.offsetWidth,g:b.offsetHeight});Z()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}
function ya(a){return t(function*(){var b=document.body;b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Y(b,{h:b.offsetWidth,g:b.offsetHeight}),topOffset:0};window.parent.postMessage(b,a.origin)})}window.addEventListener("message",a=>t(function*(){if(va.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield xa(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield ya(a)))}}));
</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, <html lang="en"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6ImUzOGIyZmQ4N2FiNjRlNWIzOGQzZjliYzA1MWQwMWRkOWE0NGEyMDAiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6XC9cL2lkZW50aXR5dG9vbGtpdC5nb29nbGVhcGlzLmNvbVwvZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIwOTE1MjIyOTY1MzQ0NDU0MzI4NiIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiJjX2YzOGRkYTRjY2E3MmFjZmJfY29taWNfYXBwXzIwMjQtNjgwIn0sImV4cCI6MTc1NDk3MzIzNiwiaWF0IjoxNzU0OTY5NjM2LCJhbGciOiJSUzI1NiJ9.zZ2Ev_fpPBFcuYZCBILLsS3bwodlNGgVmfvRu-sJnIFCSkV34ySfYmHseb8HbgKj_pe_qEoH4X09W6AxJQ_hIGRCcZBTsJwIJs-c6X0ydNYIP0bC0Jit6gUZFkBLizXfYHY8QTYqhLYaNeTdh92vQXLVpGsjR3hIJRVmVXxLX0w1ytuLwd3wKe9PDKNDesuB7L1Pw_qymFM3t6KLlQcofS1QiOXe4s1YT666GMgeEMT0BJi3cYMVPXAwgqeBF9eYHtmEJk2bf97-8fBaGkou-T1Zm3EJ_qF5xHBiqeEQX90DQh4YbIjnT5e6DF4Z7tyhu2czRZ_QxJVHextSWDrOhA","c_f38dda4cca72acfb_comic_app_2024-680")</script><script>'use strict';var h=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,b,d){if(a==Array.prototype||a==Object.prototype)return a;a[b]=d.value;return a};function l(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var d=a[b];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");}var n=l(this);
function q(a,b){if(b)a:{var d=n;a=a.split(".");for(var c=0;c<a.length-1;c++){var f=a[c];if(!(f in d))break a;d=d[f]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&b!=null&&h(d,a,{configurable:!0,writable:!0,value:b})}}function r(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,f){function e(g){g.done?c(g.value):Promise.resolve(g.value).then(b,d).then(e,f)}e(a.next())})}function t(a){return r(a())}
q("Object.values",function(a){return a?a:function(b){var d=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&d.push(b[c]);return d}});q("Array.prototype.includes",function(a){return a?a:function(b,d){var c=this;c instanceof String&&(c=String(c));var f=c.length;d=d||0;for(d<0&&(d=Math.max(d+f,0));d<f;d++){var e=c[d];if(e===b||Object.is(e,b))return!0}return!1}});/*

 MIT License

 Copyright (c) 2017-2023 W.Y.

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 SOFTWARE.

*/
function u(a,b){const d=a.style;b.backgroundColor&&(d.backgroundColor=b.backgroundColor);b.width&&(d.width=`${b.width}px`);b.height&&(d.height=`${b.height}px`);const c=b.style;c!=null&&Object.keys(c).forEach(f=>{d[f]=c[f]})};var v=(()=>{let a=0;return()=>{a+=1;return`u${`0000${(Math.random()*1679616<<0).toString(36)}`.slice(-4)}${a}`}})();function w(a){const b=[];for(let d=0,c=a.length;d<c;d++)b.push(a[d]);return b}function x(a,b){return(a=(a.ownerDocument.defaultView||window).getComputedStyle(a).getPropertyValue(b))?parseFloat(a.replace("px","")):0}
function y(a,b={}){var d;if(!(d=b.width)){d=x(a,"border-left-width");var c=x(a,"border-right-width");d=a.clientWidth+d+c}(b=b.height)||(b=x(a,"border-top-width"),c=x(a,"border-bottom-width"),b=a.clientHeight+b+c);return{width:d,height:b}}function z(a){return new Promise((b,d)=>{const c=new Image;c.onload=()=>{c.decode().then(()=>{requestAnimationFrame(()=>b(c))})};c.onerror=d;c.crossOrigin="anonymous";c.decoding="async";c.src=a})}
function A(a){return t(function*(){return Promise.resolve().then(()=>(new XMLSerializer).serializeToString(a)).then(encodeURIComponent).then(b=>`data:image/svg+xml;charset=utf-8,${b}`)})}
function B(a,b,d){return t(function*(){const c=document.createElementNS("http://www.w3.org/2000/svg","svg"),f=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");c.setAttribute("width",`${b}`);c.setAttribute("height",`${d}`);c.setAttribute("viewBox",`0 0 ${b} ${d}`);f.setAttribute("width","100%");f.setAttribute("height","100%");f.setAttribute("x","0");f.setAttribute("y","0");f.setAttribute("externalResourcesRequired","true");c.appendChild(f);f.appendChild(a);return A(c)})}
var C=(a,b)=>{if(a instanceof b)return!0;a=Object.getPrototypeOf(a);return a===null?!1:a.constructor.name===b.name||C(a,b)};function D(a){return w(a).map(b=>{const d=a.getPropertyValue(b),c=a.getPropertyPriority(b);return`${b}: ${d}${c?" !important":""};`}).join(" ")}
function E(a,b,d){a=window.getComputedStyle(a,d);var c=a.getPropertyValue("content");if(c!==""&&c!=="none"){var f=v();try{b.className=`${b.className} ${f}`}catch(g){return}c=document.createElement("style");var e=c.appendChild;d=`.${f}:${d}`;a.cssText?(f=a.getPropertyValue("content"),a=`${a.cssText} content: '${f.replace(/'|"/g,"")}';`):a=D(a);e.call(c,document.createTextNode(`${d}{${a}}`));b.appendChild(c)}};function F(a){return a.search(/^(data:)/)!==-1}function G(a,b,d){return t(function*(){const c=yield fetch(a,b);if(c.status===404)throw Error(`Resource "${c.url}" not found`);const f=yield c.blob();return new Promise((e,g)=>{const k=new FileReader;k.onerror=g;k.onloadend=()=>{try{e(d({l:c,result:k.result}))}catch(m){g(m)}};k.readAsDataURL(f)})})}const H={};function I(a,b,d){let c=a.replace(/\?.*/,"");d&&(c=a);/ttf|otf|eot|woff2?/i.test(c)&&(c=c.replace(/.*\//,""));return b?`[${b}]${c}`:c}
function J(a,b,d){return t(function*(){const c=I(a,b,d.A);if(H[c]!=null)return H[c];d.m&&(a+=(/\?/.test(a)?"&":"?")+(new Date).getTime());let f;try{const e=yield G(a,d.i,({l:g,result:k})=>{b||(b=g.headers.get("Content-Type")||"");return k.split(/,/)[1]});f=`data:${b};base64,${e}`}catch(e){f=d.v||""}return H[c]=f})};const K={N:"application/font-woff",O:"application/font-woff",L:"application/font-truetype",o:"application/vnd.ms-fontobject",F:"image/png",C:"image/jpeg",B:"image/jpeg",u:"image/gif",K:"image/tiff",J:"image/svg+xml",M:"image/webp"};function L(a){return(a=/\.([^./]*?)$/g.exec(a))?a[1]:""};function M(a){return t(function*(){const b=a.toDataURL();return b==="data:,"?a.cloneNode(!1):z(b)})}function N(a,b){return t(function*(){if(a.currentSrc){var d=document.createElement("canvas");const c=d.getContext("2d");d.width=a.clientWidth;d.height=a.clientHeight;c==null||c.drawImage(a,0,0,d.width,d.height);d=d.toDataURL();return z(d)}d=a.poster;d=yield J(d,K[L(d).toLowerCase()]||"",b);return z(d)})}
function O(a){return t(function*(){try{let b;if(a==null?0:(b=a.contentDocument)==null?0:b.body)return yield P(a.contentDocument.body,{},!0)}catch(b){}return a.cloneNode(!1)})}function aa(a,b){return t(function*(){return C(a,HTMLCanvasElement)?M(a):C(a,HTMLVideoElement)?N(a,b):C(a,HTMLIFrameElement)?O(a):a.cloneNode(!1)})}
function ba(a,b,d){return t(function*(){let c=[];if(a.tagName!=null&&a.tagName.toUpperCase()==="SLOT"&&a.assignedNodes)c=w(a.assignedNodes());else{let f;if(C(a,HTMLIFrameElement)&&((f=a.contentDocument)==null?0:f.body))c=w(a.contentDocument.body.childNodes);else{let e;c=w(((e=a.shadowRoot)!=null?e:a).childNodes)}}if(c.length===0||C(a,HTMLVideoElement))return b;yield c.reduce((f,e)=>f.then(()=>P(e,d)).then(g=>{g&&b.appendChild(g)}),Promise.resolve());return b})}
function ca(a,b){const d=b.style;if(d){var c=window.getComputedStyle(a);c.cssText?(d.style.cssText=c.cssText,d.transformOrigin=c.transformOrigin):w(c).forEach(f=>{let e=c.getPropertyValue(f);f==="font-size"&&e.endsWith("px")&&(e=`${Math.floor(parseFloat(e.substring(0,e.length-2)))-.1}px`);C(a,HTMLIFrameElement)&&f==="display"&&e==="inline"&&(e="block");f==="d"&&b.getAttribute("d")&&(e=`path(${b.getAttribute("d")})`);d.setProperty(f,e,c.getPropertyPriority(f))})}}
function da(a,b){C(a,HTMLSelectElement)&&(b=Array.from(b.children).find(d=>a.value===d.getAttribute("value")))&&b.setAttribute("selected","")}
function ea(a,b){return t(function*(){var d=a.querySelectorAll?a.querySelectorAll("use"):[];if(d.length===0)return a;var c={};for(var f=0;f<d.length;f++){var e=d[f].getAttribute("xlink:href");if(e){const g=document.querySelector(e);a.querySelector(e)||!g||c[e]||(c[e]=yield P(g,b,!0))}}d=Object.values(c);if(d.length){c=document.createElementNS("http://www.w3.org/1999/xhtml","svg");c.setAttribute("xmlns","http://www.w3.org/1999/xhtml");c.style.position="absolute";c.style.width="0";c.style.height="0";
c.style.overflow="hidden";c.style.display="none";f=document.createElementNS("http://www.w3.org/1999/xhtml","defs");c.appendChild(f);for(e=0;e<d.length;e++)f.appendChild(d[e]);a.appendChild(c)}return a})}
function P(a,b,d){return t(function*(){return d||!b.filter||b.filter(a)?Promise.resolve(a).then(c=>aa(c,b)).then(c=>ba(a,c,b)).then(c=>{C(c,Element)&&(ca(a,c),E(a,c,":before"),E(a,c,":after"),C(a,HTMLTextAreaElement)&&(c.textContent=a.value),C(a,HTMLInputElement)&&c.setAttribute("value",a.value),da(a,c));return c}).then(c=>ea(c,b)):null})};const Q=/url\((['"]?)([^'"]+?)\1\)/g,fa=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,ha=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ia(a){const b=[];a.replace(Q,(d,c,f)=>{b.push(f);return d});return b.filter(d=>!F(d))}
function ja(a,b,d,c){return t(function*(){try{const f=d?(new URL(b,d||void 0)).toString():b;let e;e=yield J(f,K[L(b).toLowerCase()]||"",c);return a.replace(new RegExp(`(url\\(['"]?)(${b.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")})(['"]?\\))`,"g"),`$1${e}$3`)}catch(f){}return a})}function ka(a,{G:b}){return b?a.replace(ha,d=>{for(;;){const [c,,f]=fa.exec(d)||[],e=c,g=f;if(!g)return"";if(g===b)return`src: ${e};`}}):a}
function R(a,b,d){return t(function*(){if(a.search(Q)===-1)return a;const c=ka(a,d);return ia(c).reduce((f,e)=>f.then(g=>ja(g,e,b,d)),Promise.resolve(c))})};function S(a,b,d){return t(function*(){var c;const f=(c=b.style)==null?void 0:c.getPropertyValue(a);return f?(c=yield R(f,null,d),b.style.setProperty(a,c,b.style.getPropertyPriority(a)),!0):!1})}function la(a,b){return t(function*(){(yield S("background",a,b))||(yield S("background-image",a,b));(yield S("mask",a,b))||(yield S("mask-image",a,b))})}
function ma(a,b){return t(function*(){const d=C(a,HTMLImageElement);if(d&&!F(a.src)||C(a,SVGImageElement)&&!F(a.href.baseVal)){var c=d?a.src:a.href.baseVal,f=yield J(c,K[L(c).toLowerCase()]||"",b);yield new Promise((e,g)=>{a.onload=e;a.onerror=g;a.decode&&(a.onload=()=>{a.decode().then(()=>{requestAnimationFrame(e)})},a.decoding="sync");a.loading==="lazy"&&(a.loading="eager");d?(a.srcset="",a.src=f):a.href.baseVal=f})}})}
function na(a,b){return t(function*(){const d=w(a.childNodes).map(c=>T(c,b));yield Promise.all(d).then(()=>a)})}function T(a,b){return t(function*(){C(a,Element)&&(yield la(a,b),yield ma(a,b),yield na(a,b))})};const U={};function V(a){return t(function*(){var b=U[a];if(b!=null)return b;b=yield(yield fetch(a)).text();b={url:a,cssText:b};return U[a]=b})}function W(a,b){return t(function*(){let d=a.cssText;const c=/url\(["']?([^"')]+)["']?\)/g,f=(d.match(/url\([^)]+\)/g)||[]).map(e=>t(function*(){let g=e.replace(c,"$1");g.startsWith("https://")||(g=(new URL(g,a.url)).href);return G(g,b.i,({result:k})=>{d=d.replace(e,`url(${k})`);return[e,k]})}));return Promise.all(f).then(()=>d)})}
function X(a){if(a==null)return[];const b=[];a=a.replace(/(\/\*[\s\S]*?\*\/)/gi,"");for(var d=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");;){var c=d.exec(a);if(c===null)break;b.push(c[0])}a=a.replace(d,"");d=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi;for(c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){let f=d.exec(a);if(f===null)if(f=c.exec(a),f===null)break;else d.lastIndex=c.lastIndex;else c.lastIndex=
d.lastIndex;b.push(f[0])}return b}
function oa(a,b){return t(function*(){const d=[],c=[];a.forEach(f=>{if("cssRules"in f)try{w(f.cssRules||[]).forEach((e,g)=>{if(e.type===CSSRule.IMPORT_RULE){let k=g+1;e=V(e.href).then(m=>W(m,b)).then(m=>X(m).forEach(p=>{try{f.insertRule(p,p.startsWith("@import")?k+=1:f.cssRules.length)}catch(za){}})).catch(()=>{});c.push(e)}})}catch(e){const g=a.find(k=>k.href==null)||document.styleSheets[0];f.href!=null&&c.push(V(f.href).then(k=>W(k,b)).then(k=>X(k).forEach(m=>{g.insertRule(m,f.cssRules.length)})).catch(()=>
{}))}});return Promise.all(c).then(()=>{a.forEach(f=>{if("cssRules"in f)try{w(f.cssRules||[]).forEach(e=>{d.push(e)})}catch(e){}});return d})})}function pa(a){return a.filter(b=>b.type===CSSRule.FONT_FACE_RULE).filter(b=>b.style.getPropertyValue("src").search(Q)!==-1)}function qa(a,b){return t(function*(){if(a.ownerDocument==null)throw Error("Provided element is not within a Document");var d=w(a.ownerDocument.styleSheets);d=yield oa(d,b);return pa(d)})}
function ra(a,b){return t(function*(){const d=yield qa(a,b);return(yield Promise.all(d.map(c=>R(c.cssText,c.parentStyleSheet?c.parentStyleSheet.href:null,b)))).join("\n")})}function sa(a,b){return t(function*(){const d=b.j!=null?b.j:b.I?null:yield ra(a,b);if(d){const c=document.createElement("style");c.appendChild(document.createTextNode(d));a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)}})};function ta(a,b={}){return t(function*(){const {width:d,height:c}=y(a,b),f=yield P(a,b,!0);yield sa(f,b);yield T(f,b);u(f,b);return yield B(f,d,c)})}
function ua(a,b={}){return t(function*(){const {width:d,height:c}=y(a,b);var f=yield ta(a,b);f=yield z(f);const e=document.createElement("canvas"),g=e.getContext("2d"),k=b.D||window.devicePixelRatio||1,m=b.h||d,p=b.g||c;e.width=m*k;e.height=p*k;!b.H&&(e.width>16384||e.height>16384)&&(e.width>16384&&e.height>16384?e.width>e.height?(e.height*=16384/e.width,e.width=16384):(e.width*=16384/e.height,e.height=16384):e.width>16384?(e.height*=16384/e.width,e.width=16384):(e.width*=16384/e.height,e.height=
16384));e.style.width=`${m}`;e.style.height=`${p}`;b.backgroundColor&&(g.fillStyle=b.backgroundColor,g.fillRect(0,0,e.width,e.height));g.drawImage(f,0,0,e.width,e.height);return e})}function Y(a,b={}){return t(function*(){return(yield ua(a,b)).toDataURL()})};const va=["gemini.google.com","corp.google.com"];function Z(){return document.body.querySelectorAll('[class*="animate"]').length>0}function wa(){return t(function*(){const a=document.body.offsetWidth,b=document.body.offsetHeight,d=document.body.cloneNode(!0);d.querySelectorAll('[class*="animate"]').forEach(c=>{c.classList.remove(...Array.from(c.classList).filter(f=>f.startsWith("animate")))});d.style.width=`${a}px`;d.style.height=`${b}px`;return d})}
function xa(a){return t(function*(){let b=document.body;if(Z()){var d=yield wa();b=d;document.body.appendChild(d)}d=yield Y(b,{h:b.offsetWidth,g:b.offsetHeight});Z()&&document.body.removeChild(b);window.parent.postMessage({type:"SEND_SCREENSHOT",image:d,topOffset:document.documentElement.scrollTop},a.origin)})}
function ya(a){return t(function*(){var b=document.body;b={type:"SEND_SCREENSHOT_FOR_DATA_VISUALIZATION",image:yield Y(b,{h:b.offsetWidth,g:b.offsetHeight}),topOffset:0};window.parent.postMessage(b,a.origin)})}window.addEventListener("message",a=>t(function*(){if(va.some(d=>a.origin.includes(d))){var b=a.data;b&&(b.type==="MAKE_SCREENSHOT"&&(yield xa(a)),b.type==="MAKE_SCREENSHOT_FOR_DATA_VISUALIZATION"&&(yield ya(a)))}}));
</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-05-20","imageModelName":"imagen-3.0-generate-002","imageEditModelName":"gemini-2.0-flash-preview-image-generation","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comedy Club AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .hidden {
            display: none;
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.mx-auto{margin-left:auto;margin-right:auto}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mr-2{margin-right:0.5rem}.mr-4{margin-right:1rem}.mt-1{margin-top:0.25rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-16{height:4rem}.h-24{height:6rem}.min-h-screen{min-height:100vh}.w-16{width:4rem}.w-full{width:100%}.w-24{width:6rem}.max-w-4xl{max-width:56rem}.max-w-md{max-width:28rem}.flex-grow{flex-grow:1}@keyframes spin{to{transform:rotate(360deg)}}.animate-spin{animation:spin 1s linear infinite}.cursor-pointer{cursor:pointer}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.border{border-width:1px}.border-2{border-width:2px}.border-gray-600{--tw-border-opacity:1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1))}.border-purple-500{--tw-border-opacity:1;border-color:rgb(168 85 247 / var(--tw-border-opacity, 1))}.border-transparent{border-color:transparent}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39 / var(--tw-bg-opacity, 1))}.bg-purple-600{--tw-bg-opacity:1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-red-600{--tw-bg-opacity:1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.placeholder-gray-400::placeholder{--tw-placeholder-opacity:1;color:rgb(156 163 175 / var(--tw-placeholder-opacity, 1))}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-600:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-700:hover{--tw-bg-opacity:1;background-color:rgb(126 34 206 / var(--tw-bg-opacity, 1))}.hover\:bg-red-700:hover{--tw-bg-opacity:1;background-color:rgb(185 28 28 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-700:hover{--tw-bg-opacity:1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-purple-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(168 85 247 / var(--tw-ring-opacity, 1))}.focus\:ring-offset-2:focus{--tw-ring-offset-width:2px}.focus\:ring-offset-gray-800:focus{--tw-ring-offset-color:#1f2937}.group:hover .group-hover\:border-purple-500{--tw-border-opacity:1;border-color:rgb(168 85 247 / var(--tw-border-opacity, 1))}@media (min-width: 640px){.sm\:flex-row{flex-direction:row}}@media (min-width: 768px){.md\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}}@media (min-width: 1024px){.lg\:grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}}</style></head>
<body class="bg-gray-900 text-white">

    <!-- App Container -->
    <div id="app" class="container mx-auto p-4 max-w-4xl">

        <!-- Login/Signup Page -->
        <div id="auth-page" class="hidden">
            <div class="flex flex-col items-center justify-center min-h-screen">
                <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-md p-8">
                    <h2 id="auth-title" class="text-2xl font-bold mb-6 text-center text-white">Login</h2>
                    <div id="auth-error" class="text-red-500 text-center mb-4"></div>
                    <form id="auth-form">
                        <div class="mb-4">
                            <label for="email" class="block text-sm font-medium text-gray-300">Email</label>
                            <input type="email" id="email" class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="any@email.com" required="">
                        </div>
                        <div class="mb-6">
                            <label for="password" class="block text-sm font-medium text-gray-300">Password</label>
                            <input type="password" id="password" class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="any password" required="">
                        </div>
                        <button type="submit" id="auth-button" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-purple-500">Login</button>
                    </form>
                    <p class="mt-6 text-center text-sm text-gray-400">
                        Enter any email and password to continue.
                    </p>
                </div>
            </div>
        </div>

        <!-- Comedian Selection Page -->
        <div id="comedian-selection-page" class="">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold">Choose a Comedian</h1>
                <div>
                    <button id="download-code-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md mr-2">Download Code</button>
                    <button id="logout-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md">Logout</button>
                </div>
            </div>
            <div id="comedian-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"><div class="bg-gray-800 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-700 transition-colors">
                    <img src="https://placehold.co/200x200/7E22CE/FFFFFF?text=ZK" alt="Zakir Khan" class="w-24 h-24 rounded-full mx-auto mb-4 border-2 border-transparent group-hover:border-purple-500">
                    <h3 class="text-lg font-semibold">Zakir Khan</h3>
                </div><div class="bg-gray-800 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-700 transition-colors">
                    <img src="https://placehold.co/200x200/9333EA/FFFFFF?text=BKR" alt="Biswa Kalyan Rath" class="w-24 h-24 rounded-full mx-auto mb-4 border-2 border-transparent group-hover:border-purple-500">
                    <h3 class="text-lg font-semibold">Biswa Kalyan Rath</h3>
                </div><div class="bg-gray-800 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-700 transition-colors">
                    <img src="https://placehold.co/200x200/A855F7/FFFFFF?text=AM" alt="Aditi Mittal" class="w-24 h-24 rounded-full mx-auto mb-4 border-2 border-transparent group-hover:border-purple-500">
                    <h3 class="text-lg font-semibold">Aditi Mittal</h3>
                </div><div class="bg-gray-800 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-700 transition-colors">
                    <img src="https://placehold.co/200x200/D946EF/FFFFFF?text=KS" alt="Kenny Sebastian" class="w-24 h-24 rounded-full mx-auto mb-4 border-2 border-transparent group-hover:border-purple-500">
                    <h3 class="text-lg font-semibold">Kenny Sebastian</h3>
                </div></div>
        </div>

        <!-- Jokes Page -->
        <div id="jokes-page" class="hidden">
            <div class="flex items-center mb-6">
                <button id="back-to-selection" class="mr-4 bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-md"> Back</button>
                <img id="comedian-img-jokes" src="" alt="" class="w-16 h-16 rounded-full mr-4 border-2 border-purple-500">
                <h1 id="comedian-name-jokes" class="text-3xl font-bold"></h1>
            </div>

            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-2xl font-semibold mb-4">Listen to their Jokes</h2>
                <div id="jokes-list" class="space-y-4">
                    <!-- Jokes will be listed here -->
                </div>
                 <div id="audio-player-container" class="mt-6 p-4 bg-gray-700 rounded-lg flex items-center justify-center hidden">
                    <span id="playing-joke-text" class="mr-4"></span>
                    <audio id="audio-player" controls=""></audio>
                </div>
            </div>

            <div class="mt-8 bg-gray-800 rounded-lg p-6">
                <h2 class="text-2xl font-semibold mb-4">Create a New Joke</h2>
                <div id="joke-generation-error" class="text-red-500 text-center mb-4"></div>
                <div class="flex flex-col sm:flex-row gap-4">
                    <input type="text" id="joke-prompt" class="flex-grow px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="e.g., 'a joke about airplanes'">
                    <button id="generate-joke-button" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-md">
                        <span id="generate-btn-text">Generate &amp; Play</span>
                        <span id="generate-spinner" class="hidden animate-spin"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // --- Comedian Data ---
        const comedians = [
            {
                id: 'zakir_khan',
                name: 'Zakir Khan',
                image: 'https://placehold.co/200x200/7E22CE/FFFFFF?text=ZK',
                voiceName: 'en-IN-Standard-B', // Example voice
                jokes: [
                    "Bhai, pyaar mein padna zaroori hai. Kyunki agar girenge nahi, toh uthenge kaise? Aur agar uthenge nahi, toh agli wali kaise milegi?",
                    "Main sakht launda hoon, par yahan main pighal gaya.",
                    "Cloud computing simple hai. Basically, kisi aur ka computer use kar rahe ho. Like your friend's Netflix account."
                ]
            },
            {
                id: 'biswa_kalyan_rath',
                name: 'Biswa Kalyan Rath',
                image: 'https://placehold.co/200x200/9333EA/FFFFFF?text=BKR',
                voiceName: 'en-IN-Standard-C', // Example voice
                jokes: [
                    "Aye Tatti, tera naam kya hai? Oh, you're not a tatti? My bad.",
                    "Banana is the most optimistic fruit. It always looks up.",
                    "Why do we have to press 'start' to shut down a computer? It's a conspiracy."
                ]
            },
            {
                id: 'aditi_mittal',
                name: 'Aditi Mittal',
                image: 'https://placehold.co/200x200/A855F7/FFFFFF?text=AM',
                voiceName: 'en-IN-Standard-A', // Example voice
                jokes: [
                    "They say women talk a lot. Have you ever heard a man trying to explain a cricket match?",
                    "Bra shopping is the only time a woman hopes she's smaller than she thinks.",
                    "My mom's solution to everything is 'shaadi kar lo'. Headache? Shaadi kar lo. Global warming? Shaadi kar lo."
                ]
            },
            {
                id: 'kenny_sebastian',
                name: 'Kenny Sebastian',
                image: 'https://placehold.co/200x200/D946EF/FFFFFF?text=KS',
                voiceName: 'en-IN-Standard-D', // Example voice
                jokes: [
                    "Chai is just a hug in a mug. A very hot, sometimes-too-milky hug.",
                    "Middle class families don't have a 'first aid kit'. We have a plastic box with one band-aid, a Dettol bottle from 1998, and a lot of cotton.",
                    "My relationship status? I'm in a committed relationship with my Wi-Fi. We have our ups and downs."
                ]
            }
        ];

        let selectedComedian = null;

        // --- UI Elements ---
        const pages = {
            auth: document.getElementById('auth-page'),
            selection: document.getElementById('comedian-selection-page'),
            jokes: document.getElementById('jokes-page'),
        };
        const authForm = document.getElementById('auth-form');
        const authError = document.getElementById('auth-error');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const logoutButton = document.getElementById('logout-button');
        const downloadCodeButton = document.getElementById('download-code-button');
        const comedianList = document.getElementById('comedian-list');
        const backToSelectionButton = document.getElementById('back-to-selection');
        const jokesList = document.getElementById('jokes-list');
        const audioPlayer = document.getElementById('audio-player');
        const audioPlayerContainer = document.getElementById('audio-player-container');
        const playingJokeText = document.getElementById('playing-joke-text');
        const generateJokeButton = document.getElementById('generate-joke-button');
        const jokePromptInput = document.getElementById('joke-prompt');
        const jokeGenerationError = document.getElementById('joke-generation-error');
        
        // --- Page Navigation ---
        function showPage(pageName) {
            Object.values(pages).forEach(page => page.classList.add('hidden'));
            pages[pageName].classList.remove('hidden');
        }

        // --- Auth Form Logic ---
        authForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const password = passwordInput.value;
            authError.textContent = '';
            
            if (email && password) {
                // If both fields have content, proceed to the app
                showPage('selection');
                populateComedians();
            } else {
                authError.textContent = "Please enter both an email and password.";
            }
        });

        logoutButton.addEventListener('click', () => {
            // Simply go back to the auth page
            showPage('auth');
            authForm.reset();
        });
        
        // --- Download Code Logic ---
        function downloadFile(filename, text) {
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        downloadCodeButton.addEventListener('click', () => {
            const htmlContent = document.documentElement.outerHTML;
            downloadFile('comedy-club-ai.html', htmlContent);
        });


        // --- Comedian Selection Logic ---
        function populateComedians() {
            comedianList.innerHTML = '';
            comedians.forEach(comedian => {
                const card = document.createElement('div');
                card.className = 'bg-gray-800 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-700 transition-colors';
                card.innerHTML = `
                    <img src="${comedian.image}" alt="${comedian.name}" class="w-24 h-24 rounded-full mx-auto mb-4 border-2 border-transparent group-hover:border-purple-500">
                    <h3 class="text-lg font-semibold">${comedian.name}</h3>
                `;
                card.addEventListener('click', () => selectComedian(comedian.id));
                comedianList.appendChild(card);
            });
        }

        function selectComedian(comedianId) {
            selectedComedian = comedians.find(c => c.id === comedianId);
            if (selectedComedian) {
                document.getElementById('comedian-img-jokes').src = selectedComedian.image;
                document.getElementById('comedian-name-jokes').textContent = selectedComedian.name;
                populateJokes();
                showPage('jokes');
            }
        }

        backToSelectionButton.addEventListener('click', () => {
            showPage('selection');
            audioPlayer.pause();
            audioPlayerContainer.classList.add('hidden');
        });

        // --- Jokes Page Logic ---
        function populateJokes() {
            jokesList.innerHTML = '';
            selectedComedian.jokes.forEach((joke, index) => {
                const jokeElement = document.createElement('div');
                jokeElement.className = 'flex items-center justify-between bg-gray-700 p-3 rounded-md';
                jokeElement.innerHTML = `
                    <p class="flex-1 mr-4 text-gray-300">"${joke}"</p>
                    <button data-joke-index="${index}" class="play-joke-button bg-purple-600 hover:bg-purple-700 text-white font-bold p-2 rounded-full w-10 h-10 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </button>
                `;
                jokesList.appendChild(jokeElement);
            });

            document.querySelectorAll('.play-joke-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const jokeIndex = e.currentTarget.getAttribute('data-joke-index');
                    const jokeText = selectedComedian.jokes[jokeIndex];
                    playJoke(jokeText);
                });
            });
        }

        // --- Gemini API Integration ---
        const GEMINI_API_KEY = "AIzaSyB-wKUZCJctpVrvgVN9RWUXWZfRGS8Wo-E";

        async function getAudioForJoke(text, voiceName) {
            console.log(`Fetching audio for: "${text}" with voice: ${voiceName}`);
            const ttsApiUrl = `https://texttospeech.googleapis.com/v1/text:synthesize?key=${GEMINI_API_KEY}`;

            const body = {
                input: { text: text },
                voice: { languageCode: 'en-IN', name: voiceName },
                audioConfig: { audioEncoding: 'MP3' }
            };

            try {
                const response = await fetch(ttsApiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                if (!response.ok) {
                    const error = await response.json();
                    console.error('Google TTS API Error:', error);
                    throw new Error(`TTS API failed: ${error.error.message}`);
                }
                const data = await response.json();
                const audioContent = data.audioContent;
                const audioBlob = new Blob([Uint8Array.from(atob(audioContent), c => c.charCodeAt(0))], { type: 'audio/mpeg' });
                return URL.createObjectURL(audioBlob);
            } catch (error) {
                console.error("Error fetching audio:", error);
                jokeGenerationError.textContent = "Could not generate audio for the joke.";
                throw error;
            }
        }

        async function generateNewJoke(prompt, comedianStyle) {
            console.log(`Generating joke for prompt: "${prompt}" in the style of ${comedianStyle}`);
            const genApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEY}`;
            
            const requestBody = {
                contents: [{
                    parts: [{
                        text: `Write a short, funny, one-liner joke about ${prompt} in the style of Indian comedian ${comedianStyle}.`
                    }]
                }]
            };

            try {
                const response = await fetch(genApiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                if (!response.ok) {
                    const error = await response.json();
                    console.error('Gemini API Error:', error);
                    throw new Error(`Gemini API failed: ${error.error.message}`);
                }
                const data = await response.json();
                const jokeText = data.candidates[0].content.parts[0].text;
                return jokeText.trim();
            } catch (error) {
                console.error("Error generating new joke:", error);
                jokeGenerationError.textContent = "Could not generate a new joke.";
                throw error;
            }
        }

        async function playJoke(jokeText) {
            try {
                playingJokeText.textContent = `Playing: "${jokeText.substring(0, 30)}..."`;
                audioPlayerContainer.classList.remove('hidden');
                const audioUrl = await getAudioForJoke(jokeText, selectedComedian.voiceName);
                audioPlayer.src = audioUrl;
                audioPlayer.play();
            } catch (error) {
                console.error("Error playing joke:", error);
                audioPlayerContainer.classList.add('hidden');
            }
        }

        generateJokeButton.addEventListener('click', async () => {
            const prompt = jokePromptInput.value.trim();
            if (!prompt) {
                jokeGenerationError.textContent = "Please enter a prompt for the joke.";
                return;
            }
            
            jokeGenerationError.textContent = '';
            const generateBtnText = document.getElementById('generate-btn-text');
            const spinner = document.getElementById('generate-spinner');

            generateBtnText.classList.add('hidden');
            spinner.classList.remove('hidden');
            generateJokeButton.disabled = true;

            try {
                const newJoke = await generateNewJoke(prompt, selectedComedian.name);
                jokePromptInput.value = '';
                selectedComedian.jokes.push(newJoke); // Add to the list for this session
                populateJokes(); // Refresh the list
                await playJoke(newJoke);
            } catch (error) {
                console.error("Error during joke generation process:", error);
                // Error message is already set by the failing function
            } finally {
                generateBtnText.classList.remove('hidden');
                spinner.classList.add('hidden');
                generateJokeButton.disabled = false;
            }
        });

        // --- Initial App Load ---
        showPage('auth');

    </script>


</body></html> };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-05-20","imageModelName":"imagen-3.0-generate-002","imageEditModelName":"gemini-2.0-flash-preview-image-generation","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comedy Club AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .hidden {
            display: none;
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.mx-auto{margin-left:auto;margin-right:auto}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mr-2{margin-right:0.5rem}.mr-4{margin-right:1rem}.mt-1{margin-top:0.25rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-16{height:4rem}.h-24{height:6rem}.min-h-screen{min-height:100vh}.w-16{width:4rem}.w-full{width:100%}.w-24{width:6rem}.max-w-4xl{max-width:56rem}.max-w-md{max-width:28rem}.flex-grow{flex-grow:1}@keyframes spin{to{transform:rotate(360deg)}}.animate-spin{animation:spin 1s linear infinite}.cursor-pointer{cursor:pointer}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.border{border-width:1px}.border-2{border-width:2px}.border-gray-600{--tw-border-opacity:1;border-color:rgb(75 85 99 / var(--tw-border-opacity, 1))}.border-purple-500{--tw-border-opacity:1;border-color:rgb(168 85 247 / var(--tw-border-opacity, 1))}.border-transparent{border-color:transparent}.bg-blue-600{--tw-bg-opacity:1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-gray-700{--tw-bg-opacity:1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.bg-gray-800{--tw-bg-opacity:1;background-color:rgb(31 41 55 / var(--tw-bg-opacity, 1))}.bg-gray-900{--tw-bg-opacity:1;background-color:rgb(17 24 39 / var(--tw-bg-opacity, 1))}.bg-purple-600{--tw-bg-opacity:1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-red-600{--tw-bg-opacity:1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-3{padding-left:0.75rem;padding-right:0.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.text-gray-300{--tw-text-opacity:1;color:rgb(209 213 219 / var(--tw-text-opacity, 1))}.text-gray-400{--tw-text-opacity:1;color:rgb(156 163 175 / var(--tw-text-opacity, 1))}.text-red-500{--tw-text-opacity:1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.placeholder-gray-400::placeholder{--tw-placeholder-opacity:1;color:rgb(156 163 175 / var(--tw-placeholder-opacity, 1))}.shadow-md{--tw-shadow:0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);--tw-shadow-colored:0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.transition-colors{transition-property:color, background-color, border-color, fill, stroke, -webkit-text-decoration-color;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke;transition-property:color, background-color, border-color, text-decoration-color, fill, stroke, -webkit-text-decoration-color;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);transition-duration:150ms}.hover\:bg-blue-700:hover{--tw-bg-opacity:1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-600:hover{--tw-bg-opacity:1;background-color:rgb(75 85 99 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-700:hover{--tw-bg-opacity:1;background-color:rgb(126 34 206 / var(--tw-bg-opacity, 1))}.hover\:bg-red-700:hover{--tw-bg-opacity:1;background-color:rgb(185 28 28 / var(--tw-bg-opacity, 1))}.hover\:bg-gray-700:hover{--tw-bg-opacity:1;background-color:rgb(55 65 81 / var(--tw-bg-opacity, 1))}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-2:focus{--tw-ring-offset-shadow:var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow:var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000)}.focus\:ring-purple-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(168 85 247 / var(--tw-ring-opacity, 1))}.focus\:ring-offset-2:focus{--tw-ring-offset-width:2px}.focus\:ring-offset-gray-800:focus{--tw-ring-offset-color:#1f2937}.group:hover .group-hover\:border-purple-500{--tw-border-opacity:1;border-color:rgb(168 85 247 / var(--tw-border-opacity, 1))}@media (min-width: 640px){.sm\:flex-row{flex-direction:row}}@media (min-width: 768px){.md\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}}@media (min-width: 1024px){.lg\:grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}}</style></head>
<body class="bg-gray-900 text-white">

    <!-- App Container -->
    <div id="app" class="container mx-auto p-4 max-w-4xl">

        <!-- Login/Signup Page -->
        <div id="auth-page" class="hidden">
            <div class="flex flex-col items-center justify-center min-h-screen">
                <div class="w-full max-w-md bg-gray-800 rounded-lg shadow-md p-8">
                    <h2 id="auth-title" class="text-2xl font-bold mb-6 text-center text-white">Login</h2>
                    <div id="auth-error" class="text-red-500 text-center mb-4"></div>
                    <form id="auth-form">
                        <div class="mb-4">
                            <label for="email" class="block text-sm font-medium text-gray-300">Email</label>
                            <input type="email" id="email" class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="any@email.com" required="">
                        </div>
                        <div class="mb-6">
                            <label for="password" class="block text-sm font-medium text-gray-300">Password</label>
                            <input type="password" id="password" class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="any password" required="">
                        </div>
                        <button type="submit" id="auth-button" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-purple-500">Login</button>
                    </form>
                    <p class="mt-6 text-center text-sm text-gray-400">
                        Enter any email and password to continue.
                    </p>
                </div>
            </div>
        </div>

        <!-- Comedian Selection Page -->
        <div id="comedian-selection-page" class="">
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-bold">Choose a Comedian</h1>
                <div>
                    <button id="download-code-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md mr-2">Download Code</button>
                    <button id="logout-button" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md">Logout</button>
                </div>
            </div>
            <div id="comedian-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"><div class="bg-gray-800 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-700 transition-colors">
                    <img src="https://placehold.co/200x200/7E22CE/FFFFFF?text=ZK" alt="Adarsh Mittal" class="w-24 h-24 rounded-full mx-auto mb-4 border-2 border-transparent group-hover:border-purple-500">
                    <h3 class="text-lg font-semibold">Adarsh Mitaal</h3>
                </div><div class="bg-gray-800 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-700 transition-colors">
                    <img src="https://placehold.co/200x200/9333EA/FFFFFF?text=BKR" alt="Jatin Arora" class="w-24 h-24 rounded-full mx-auto mb-4 border-2 border-transparent group-hover:border-purple-500">
                    <h3 class="text-lg font-semibold">Jatin Arora</h3>
                </div><div class="bg-gray-800 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-700 transition-colors">
                    <img src="https://placehold.co/200x200/A855F7/FFFFFF?text=AM" alt="Ishan Kumar" class="w-24 h-24 rounded-full mx-auto mb-4 border-2 border-transparent group-hover:border-purple-500">
                    <h3 class="text-lg font-semibold">Ishan Kumar</h3>
                </div><div class="bg-gray-800 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-700 transition-colors">
                    <img src="https://placehold.co/200x200/D946EF/FFFFFF?text=KS" alt="Puttu" class="w-24 h-24 rounded-full mx-auto mb-4 border-2 border-transparent group-hover:border-purple-500">
                    <h3 class="text-lg font-semibold">Puttu Tuttu</h3>
                </div></div>
        </div>

        <!-- Jokes Page -->
        <div id="jokes-page" class="hidden">
            <div class="flex items-center mb-6">
                <button id="back-to-selection" class="mr-4 bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-md"> Back</button>
                <img id="comedian-img-jokes" src="" alt="" class="w-16 h-16 rounded-full mr-4 border-2 border-purple-500">
                <h1 id="comedian-name-jokes" class="text-3xl font-bold"></h1>
            </div>

            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-2xl font-semibold mb-4">Listen to their Jokes</h2>
                <div id="jokes-list" class="space-y-4">
                    <!-- Jokes will be listed here -->
                </div>
                 <div id="audio-player-container" class="mt-6 p-4 bg-gray-700 rounded-lg flex items-center justify-center hidden">
                    <span id="playing-joke-text" class="mr-4"></span>
                    <audio id="audio-player" controls=""></audio>
                </div>
            </div>

            <div class="mt-8 bg-gray-800 rounded-lg p-6">
                <h2 class="text-2xl font-semibold mb-4">Create a New Joke</h2>
                <div id="joke-generation-error" class="text-red-500 text-center mb-4"></div>
                <div class="flex flex-col sm:flex-row gap-4">
                    <input type="text" id="joke-prompt" class="flex-grow px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="e.g., 'a joke about airplanes'">
                    <button id="generate-joke-button" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-md">
                        <span id="generate-btn-text">Generate &amp; Play</span>
                        <span id="generate-spinner" class="hidden animate-spin"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // --- Comedian Data ---
        const comedians = [
            {
                id: 'zakir_khan',
                name: 'Zakir Khan',
                image: 'https://placehold.co/200x200/7E22CE/FFFFFF?text=ZK',
                voiceName: 'en-IN-Standard-B', // Example voice
                jokes: [
                    "Bhai, pyaar mein padna zaroori hai. Kyunki agar girenge nahi, toh uthenge kaise? Aur agar uthenge nahi, toh agli wali kaise milegi?",
                    "Main sakht launda hoon, par yahan main pighal gaya.",
                    "Cloud computing simple hai. Basically, kisi aur ka computer use kar rahe ho. Like your friend's Netflix account."
                ]
            },
            {
                id: 'biswa_kalyan_rath',
                name: 'Biswa Kalyan Rath',
                image: 'https://placehold.co/200x200/9333EA/FFFFFF?text=BKR',
                voiceName: 'en-IN-Standard-C', // Example voice
                jokes: [
                    "Aye Tatti, tera naam kya hai? Oh, you're not a tatti? My bad.",
                    "Banana is the most optimistic fruit. It always looks up.",
                    "Why do we have to press 'start' to shut down a computer? It's a conspiracy."
                ]
            },
            {
                id: 'aditi_mittal',
                name: 'Aditi Mittal',
                image: 'https://placehold.co/200x200/A855F7/FFFFFF?text=AM',
                voiceName: 'en-IN-Standard-A', // Example voice
                jokes: [
                    "They say women talk a lot. Have you ever heard a man trying to explain a cricket match?",
                    "Bra shopping is the only time a woman hopes she's smaller than she thinks.",
                    "My mom's solution to everything is 'shaadi kar lo'. Headache? Shaadi kar lo. Global warming? Shaadi kar lo."
                ]
            },
            {
                id: 'kenny_sebastian',
                name: 'Kenny Sebastian',
                image: 'https://placehold.co/200x200/D946EF/FFFFFF?text=KS',
                voiceName: 'en-IN-Standard-D', // Example voice
                jokes: [
                    "Chai is just a hug in a mug. A very hot, sometimes-too-milky hug.",
                    "Middle class families don't have a 'first aid kit'. We have a plastic box with one band-aid, a Dettol bottle from 1998, and a lot of cotton.",
                    "My relationship status? I'm in a committed relationship with my Wi-Fi. We have our ups and downs."
                ]
            }
        ];

        let selectedComedian = null;

        // --- UI Elements ---
        const pages = {
            auth: document.getElementById('auth-page'),
            selection: document.getElementById('comedian-selection-page'),
            jokes: document.getElementById('jokes-page'),
        };
        const authForm = document.getElementById('auth-form');
        const authError = document.getElementById('auth-error');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const logoutButton = document.getElementById('logout-button');
        const downloadCodeButton = document.getElementById('download-code-button');
        const comedianList = document.getElementById('comedian-list');
        const backToSelectionButton = document.getElementById('back-to-selection');
        const jokesList = document.getElementById('jokes-list');
        const audioPlayer = document.getElementById('audio-player');
        const audioPlayerContainer = document.getElementById('audio-player-container');
        const playingJokeText = document.getElementById('playing-joke-text');
        const generateJokeButton = document.getElementById('generate-joke-button');
        const jokePromptInput = document.getElementById('joke-prompt');
        const jokeGenerationError = document.getElementById('joke-generation-error');
        
        // --- Page Navigation ---
        function showPage(pageName) {
            Object.values(pages).forEach(page => page.classList.add('hidden'));
            pages[pageName].classList.remove('hidden');
        }

        // --- Auth Form Logic ---
        authForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = emailInput.value;
            const password = passwordInput.value;
            authError.textContent = '';
            
            if (email && password) {
                // If both fields have content, proceed to the app
                showPage('selection');
                populateComedians();
            } else {
                authError.textContent = "Please enter both an email and password.";
            }
        });

        logoutButton.addEventListener('click', () => {
            // Simply go back to the auth page
            showPage('auth');
            authForm.reset();
        });
        
        // --- Download Code Logic ---
        function downloadFile(filename, text) {
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', filename);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        downloadCodeButton.addEventListener('click', () => {
            const htmlContent = document.documentElement.outerHTML;
            downloadFile('comedy-club-ai.html', htmlContent);
        });


        // --- Comedian Selection Logic ---
        function populateComedians() {
            comedianList.innerHTML = '';
            comedians.forEach(comedian => {
                const card = document.createElement('div');
                card.className = 'bg-gray-800 rounded-lg p-4 text-center cursor-pointer hover:bg-gray-700 transition-colors';
                card.innerHTML = `
                    <img src="${comedian.image}" alt="${comedian.name}" class="w-24 h-24 rounded-full mx-auto mb-4 border-2 border-transparent group-hover:border-purple-500">
                    <h3 class="text-lg font-semibold">${comedian.name}</h3>
                `;
                card.addEventListener('click', () => selectComedian(comedian.id));
                comedianList.appendChild(card);
            });
        }

        function selectComedian(comedianId) {
            selectedComedian = comedians.find(c => c.id === comedianId);
            if (selectedComedian) {
                document.getElementById('comedian-img-jokes').src = selectedComedian.image;
                document.getElementById('comedian-name-jokes').textContent = selectedComedian.name;
                populateJokes();
                showPage('jokes');
            }
        }

        backToSelectionButton.addEventListener('click', () => {
            showPage('selection');
            audioPlayer.pause();
            audioPlayerContainer.classList.add('hidden');
        });

        // --- Jokes Page Logic ---
        function populateJokes() {
            jokesList.innerHTML = '';
            selectedComedian.jokes.forEach((joke, index) => {
                const jokeElement = document.createElement('div');
                jokeElement.className = 'flex items-center justify-between bg-gray-700 p-3 rounded-md';
                jokeElement.innerHTML = `
                    <p class="flex-1 mr-4 text-gray-300">"${joke}"</p>
                    <button data-joke-index="${index}" class="play-joke-button bg-purple-600 hover:bg-purple-700 text-white font-bold p-2 rounded-full w-10 h-10 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </button>
                `;
                jokesList.appendChild(jokeElement);
            });

            document.querySelectorAll('.play-joke-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const jokeIndex = e.currentTarget.getAttribute('data-joke-index');
                    const jokeText = selectedComedian.jokes[jokeIndex];
                    playJoke(jokeText);
                });
            });
        }

        // --- Gemini API Integration ---
        const GEMINI_API_KEY = "AIzaSyB-wKUZCJctpVrvgVN9RWUXWZfRGS8Wo-E";

        async function getAudioForJoke(text, voiceName) {
            console.log(`Fetching audio for: "${text}" with voice: ${voiceName}`);
            const ttsApiUrl = `https://texttospeech.googleapis.com/v1/text:synthesize?key=${GEMINI_API_KEY}`;

            const body = {
                input: { text: text },
                voice: { languageCode: 'en-IN', name: voiceName },
                audioConfig: { audioEncoding: 'MP3' }
            };

            try {
                const response = await fetch(ttsApiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                if (!response.ok) {
                    const error = await response.json();
                    console.error('Google TTS API Error:', error);
                    throw new Error(`TTS API failed: ${error.error.message}`);
                }
                const data = await response.json();
                const audioContent = data.audioContent;
                const audioBlob = new Blob([Uint8Array.from(atob(audioContent), c => c.charCodeAt(0))], { type: 'audio/mpeg' });
                return URL.createObjectURL(audioBlob);
            } catch (error) {
                console.error("Error fetching audio:", error);
                jokeGenerationError.textContent = "Could not generate audio for the joke.";
                throw error;
            }
        }

        async function generateNewJoke(prompt, comedianStyle) {
            console.log(`Generating joke for prompt: "${prompt}" in the style of ${comedianStyle}`);
            const genApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${GEMINI_API_KEY}`;
            
            const requestBody = {
                contents: [{
                    parts: [{
                        text: `Write a short, funny, one-liner joke about ${prompt} in the style of Indian comedian ${comedianStyle}.`
                    }]
                }]
            };

            try {
                const response = await fetch(genApiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });
                if (!response.ok) {
                    const error = await response.json();
                    console.error('Gemini API Error:', error);
                    throw new Error(`Gemini API failed: ${error.error.message}`);
                }
                const data = await response.json();
                const jokeText = data.candidates[0].content.parts[0].text;
                return jokeText.trim();
            } catch (error) {
                console.error("Error generating new joke:", error);
                jokeGenerationError.textContent = "Could not generate a new joke.";
                throw error;
            }
        }

        async function playJoke(jokeText) {
            try {
                playingJokeText.textContent = `Playing: "${jokeText.substring(0, 30)}..."`;
                audioPlayerContainer.classList.remove('hidden');
                const audioUrl = await getAudioForJoke(jokeText, selectedComedian.voiceName);
                audioPlayer.src = audioUrl;
                audioPlayer.play();
            } catch (error) {
                console.error("Error playing joke:", error);
                audioPlayerContainer.classList.add('hidden');
            }
        }

        generateJokeButton.addEventListener('click', async () => {
            const prompt = jokePromptInput.value.trim();
            if (!prompt) {
                jokeGenerationError.textContent = "Please enter a prompt for the joke.";
                return;
            }
            
            jokeGenerationError.textContent = '';
            const generateBtnText = document.getElementById('generate-btn-text');
            const spinner = document.getElementById('generate-spinner');

            generateBtnText.classList.add('hidden');
            spinner.classList.remove('hidden');
            generateJokeButton.disabled = true;

            try {
                const newJoke = await generateNewJoke(prompt, selectedComedian.name);
                jokePromptInput.value = '';
                selectedComedian.jokes.push(newJoke); // Add to the list for this session
                populateJokes(); // Refresh the list
                await playJoke(newJoke);
            } catch (error) {
                console.error("Error during joke generation process:", error);
                // Error message is already set by the failing function
            } finally {
                generateBtnText.classList.remove('hidden');
                spinner.classList.add('hidden');
                generateJokeButton.disabled = false;
            }
        });

        // --- Initial App Load ---
        showPage('auth');

    </script>


</body></html>
